---
title: 리눅스 웹 서버로 파이선 실행하기 - 아파치
date: 2020-01-24 10:20
categories:
- [프로그래밍, 리눅스]
hidden: true
---

## 상황
* [mp4를 gif 형태로 바꿔주는 사이트](https://ezgif.com/video-to-gif)가 있다.
* 이런 사이트처럼 파일, 혹은 쿼리문을 받고 그걸 가지고 리눅스 서버에서 프로그래밍을 통해 결과물을 다운로드 링크로 제공하고자 한다.
* 웹 서버로 파이선을 실행하려면 아파치와 파이선을 연결하는 cgi를 활용하면 된다.

## 구현
* 이 포스트에서는 다음을 구현한다.
1. 웹 페이지를 하나 만든다. 웹 페이지에는 숫자를 입력할 수 있는 두 textbox와 send 버튼이 있다.
2. 숫자 2개를 넣고 send를 누르면, 숫자의 합이 적힌 txt 파일을 만든다.
3. 해당 파일을 다운로드할 수 있는 하이퍼링크를 페이지에 띄워준다.

## 설치 및 세팅
```bash
sudo apt-get install apache2 # 웹 서버가 필요하다.
```

```bash
sudo vi /etc/apache2/sites-enabled/000-default # 설정 파일을 연다.
```

설정 파일에서 아래 내용을 추가한다.
```bash
<Directory /var/www>
    Order allow,deny
    allow from all
    Options +ExecCGI # 이 부분 새로 추가
    AddHandler cgi-script .cgi .py # 이 부분 새로 추가
</Directory>
```

## 사용법
* 아래 두 파일을 만든다.
```html
<!-- index.html -->
<!-- /var/www/index.html -->
<!doctype>
<html>
<head>
</head>
<body>

<form name="form" method="get" action="http://localhost/plus.py">
<p>
num_1	: <input type="text" name="num_1">
num_2	: <input type="text" name="num_2">
<input type="submit" value="send">
</p>
</form>

</body>
</html>
```

```python
# plus.py
# /var/www/plus.py

import cgi
import cgitb    #스크립트 오류 등의 에러발생시 브라우저에 에러 내용을 보여준다.
cgitb.enable()

print("Content-type: text/html\n")    #\n 을 안하면 Internal Server Error 발생!

print('<html>')
print('<head>')
print('<title>Keyword</title>')
print('</head>')
print('<body>')

form = cgi.FieldStorage()

if "num_1" not in form or "num_1" not in form:
    print("Error!")
else:
    sum = int(form["num_2"].value) + int(form["num_2"].value)
    sum = str(sum)

    with open("result.txt","w") as f:
        f.write(sum)

    print("<a href="http://your-ip-address/result.txt" download>result</a>")

print('</body>')
print('</html>')
```

* 두 파일을 만들었으면, http://your-ip-address/ 로 들어간다. index.html이 실행되고, 다음과 같은 실행 창을 볼 수 있다.
<# 대충 사진 짤 #>
## 참고자료
* [서버의 파일을 어떻게 다운로드 가능한 링크로 만드나요?](https://stackoverflow.com/questions/10956587/how-to-create-a-downloadable-public-link-for-files-on-server)
* [파이썬3로 CGI 이용하기](https://parksk.tistory.com/120)
